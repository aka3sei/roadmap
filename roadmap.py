import streamlit as st

# ページ設定
st.set_page_config(page_title="不動産取引・マスターガイド", layout="wide")

st.title("🗺️ 不動産取引・完全網羅プロフェッショナルガイド")
st.write("プロの視点から見た「取引の急所」をすべて公開。安全・有利な取引を実現します。")

tab_sell, tab_buy = st.tabs(["🏠 売却の全工程（プロ視点）", "🔑 購入の全工程（プロ視点）"])

# ==========================================
# 🏠 売却セクション
# ==========================================
with tab_sell:
    sell_steps = ["1.売買相談", "2.物件調査", "3.査定", "4.媒介契約", "5.インスペクション", "6.広告・売却活動", "7.契約交渉", "8.重要事項説明", "9.引渡・登記・決済"]
    
    sell_details = {
        "1.売買相談": {
            "内容": """売却の目的（住み替え、相続、資産整理）を整理し、スケジュールを逆算します。単に売るだけでなく、税金対策や買い替え先の確保を含めたトータルデザインを行います。""",
            "アクション": """・売却希望時期の確定\n・残債の確認（住宅ローン一括返済の可否）\n・住み替え先の内定（先行購入か先行売却か）""",
            "重要ポイント": """【戦略の急所】「なぜ売るのか」によって出口戦略が180度変わります。買い替えなら「期限優先」で買取保証を付け、相続なら「価格優先」で時間をかけて市場に晒します。特に『先行購入』の場合、売却が遅れるとダブルローンのリスクや売却価格の妥協を強いられるため、最初の1ヶ月の反響分析が勝敗を分けます。"""
        },
        "2.物件調査": {
            "内容": """公図・謄本での権利関係確認、道路の接道状況、上下水道の埋設管、都市計画法や建築基準法の制限を網羅的に調べます。""",
            "アクション": """・法務局での謄本取得\n・役所での道路、都市計画調査\n・現地の境界標の確認（紛失していないか）""",
            "重要ポイント": """【トラブルの芽を摘む】プロは「謄本の裏」を読みます。差押や仮登記の有無はもちろん、隣地との「境界同意書」が保管されているかを確認します。戸建の場合、古い分譲地では「隣家の配管が自分の敷地を通っている」などの埋設管トラブルが決済直前に発覚することがあります。これを初期に見つけるのがプロの仕事です。"""
        },
        "3.査定": {
            "内容": """過去1年の近隣成約事例、地価公示、現在の競合物件を比較分析。建物のメンテナンス状況（外壁塗装、内装リフォーム履歴）を価格に反映させます。""",
            "アクション": """・机上査定（データ分析）\n・訪問査定（建物の個別状態確認）\n・リフォーム履歴一覧の作成""",
            "重要ポイント": """【価格の正体】査定額は「売れる価格」であって「売りたい価格」ではありません。プロは『競合物件が今何件あるか』と『その物件が何ヶ月滞留しているか』から逆算します。高すぎる査定は「干される（市場で鮮度が落ちる）」リスクを招きます。適正価格より5%高い「チャレンジ価格」を設定しつつ、2週間ごとに価格改定の判断を下すのが成功の鉄則です。"""
        },
        "4.媒介契約": {
            "内容": """売却活動を依頼する法的契約です。「専属専任」「専任」「一般」の3形態から選び、販売方針を決定します。""",
            "アクション": """・媒介契約書の締結\n・販売図面作成用のヒアリングへの回答\n・鍵の預け入れ（空家の場合）""",
            "重要ポイント": """【契約の選択】「一般媒介で競わせる」のは一見有利ですが、不動産会社側の広告費投下意欲が削がれる諸刃の剣です。プロが勧めるのは、活動報告が義務化され、本気で広告費を投じる「専任媒介」です。レインズ（流通機構）への登録証明書を必ず確認し、他社からの問い合わせを隠す『囲い込み』が行われていないか、セカンドオピニオンを持つことも検討してください。"""
        },
        "5.インスペクション": {
            "内容": """既存住宅状況調査技術者の資格を持つ建築士が、建物の構造耐力主要部や雨水の浸入を防止する部分を検査します。""",
            "アクション": """・専門業者の手配\n・床下、屋根裏、外壁のクラック確認\n・報告書の受領""",
            "重要ポイント": """【防御と付加価値】これは買主のためだけでなく、売主の「身を守る盾」です。事前に欠陥を開示することで、引渡し後の『契約不適合責任』による多額の修補請求を法的に防げます。また、「適合」の判定が出れば、住宅ローン控除の適用範囲が広がるなど、買主にとっての金銭的メリットを訴求でき、結果として値引き交渉を跳ね返す強力な武器になります。"""
        },
        "6.広告・売却活動": {
            "内容": """SUUMOやホームズへの掲載に加え、プロカメラマンによる撮影、VRツアーの作成、オープンハウスの開催など、露出を最大化します。""",
            "アクション": """・写真撮影前のハウスクリーニング、片付け\n・内覧希望者への対応、お茶出し検討\n・週次・月次での反響数チェック""",
            "重要ポイント": """【印象の演出】内覧は「お見合い」です。プロは照明を全て点け、全てのカーテンを開けるよう指示します。特に「玄関の靴を全てしまう」「水回りの水滴を拭き取る」「生活臭を消す」という3点は、成約率を3倍変えます。反響が少ない場合は、画像1枚目の変更や、キャッチコピーをターゲット層（単身・子育て等）に合わせて即座に書き換える機動力が必要です。"""
        },
        "7.契約交渉": {
            "内容": """購入希望者から届く「買付証明書」に対し、価格だけでなく、引渡し時期、付帯設備（エアコンを残すか等）を調整します。""",
            "アクション": """・購入希望者の属性（ローン利用か現金か）確認\n・条件交渉（指値への回答）\n・契約日の決定""",
            "重要ポイント": """【交渉の力学】「100万円負けて」という指値に対し、単純に応じるのは二流です。プロは「価格を下げる代わりに、現況有姿（直さず渡す）にする」「引渡しを自分の新居に合わせてもらう」といったバーター取引を提案します。また、買主の融資承認の確実性（事前審査の有無）を徹底的に確認し、契約後にローン否決で白紙に戻る「時間の無駄」を回避します。"""
        },
        "8.重要事項説明": {
            "内容": """宅建士が買主へ物件の全て（リスク含む）を説明します。売主も内容に相違がないか、告知事項に漏れがないか最終チェックを行います。""",
            "アクション": """・告知事項（事故歴、近隣トラブル等）の最終確認\n・付帯設備表、物件状況報告書の作成""",
            "重要ポイント": """【開示の技術】不利な情報ほど、物語の序盤で伝えるのがプロです。重説の場で初めて聞くネガティブ情報は、買主に不信感を与え、契約直前のキャンセルを招きます。近隣に癖のある住人がいる、過去に漏水があった等の事実は、査定段階から共有し、価格に織り込み済みであることを説明することで、法的・心理的な安全圏を確保します。"""
        },
        "9.引渡・登記・決済": {
            "内容": """司法書士立ち会いのもと、残代金を受領。固定資産税の精算を行い、管理費等の清算、鍵の引き渡し、登記申請を同時に行います。""",
            "アクション": """・実印、印鑑証明書、権利証の準備\n・残債の完済手続き（銀行窓口）\n・管理費等の日割り精算""",
            "重要ポイント": """【最後の詰め】決済当日に「権利証がない」「印鑑証明が古い」というミスは許されません。数日前に司法書士と連携し書類を完備します。また、プロは決済の「3日前」に現地の最終確認を推奨します。付帯設備表に書いた通りにエアコンが動くか、ゴミが残っていないか。最後の最後で「誠実さ」を見せることが、引渡し後の円満な関係と、将来のトラブル防止に直結します。"""
        }
    }

    current_sell = st.select_slider("売却工程を選択", options=sell_steps, key="s_pro")
    
    st.markdown(f"## 🏁 {current_sell}")
    s_col1, s_col2 = st.columns([2, 3])
    with s_col1:
        st.info(f"#### 📝 実務内容とアクション\n{sell_details[current_sell]['内容']}\n\n**【具体的なタスク】**\n{sell_details[current_sell]['アクション']}")
    with s_col2:
        st.success(f"#### 💡 プロフェッショナル・ポイント（深掘り）\n{sell_details[current_sell]['重要ポイント']}")

    st.progress((sell_steps.index(current_sell) + 1) / len(sell_steps))

# ==========================================
# 🔑 購入セクション
# ==========================================
with tab_buy:
    buy_steps = ["1.購入相談", "2.資金計画", "3.物件調査", "4.購入申込", "5.契約交渉", "6.媒介契約", "7.重要事項説明", "8.売買契約締結", "9.住宅ローン審査", "10.引渡・登記・決済"]
    
    buy_details = {
        "1.購入相談": {
            "内容": """単なる広さや価格だけでなく、ライフスタイル（通勤、子育て環境、将来の売却可能性）に基づいた条件設定を行います。""",
            "アクション": """・希望エリアの優先順位付け\n・最低限必要なスペックの書き出し\n・将来のライフイベントの整理""",
            "ポイント": """【資産価値の視点】自分の好みだけでなく「10年後に誰に売れるか」というリセールバリューの視点をプロは授けます。人口動態、再開発計画、駅徒歩10分以内という『流動性の確保』は、万が一のライフスタイル変更時に家族を救う保険になります。「住みたい家」と「買ってもいい資産」の最大公約数を見つけるのが最初のゴールです。"""
        },
        "2.資金計画": {
            "内容": """年収から算出する『借りられる額』ではなく、生活費から逆算する『返せる額』を算出。諸費用（物件価格の約7〜10%）を正確に把握します。""",
            "アクション": """・金融機関での事前審査（必須）\n・諸費用（仲介手数料、登記費用、印紙代）の内訳確認\n・ペアローン、合算の検討""",
            "ポイント": """【真の購買力】金利優遇（0.3%台など）を引き出すには、健康状態や勤務先の属性を活かした銀行選びが不可欠です。また、プロは「物件価格以外」のコストを徹底的に洗い出します。引っ越し代、家具家電、不動産取得税。これらを予備費として確保した上で、事前審査を「満額」で通しておきます。この「審査済みのカード」があるかないかで、一番手争いの勝率が決まります。"""
        },
        "3.物件調査": {
            "内容": """内見に加え、マンションなら『重要事項調査報告書』で積立金の不足や修繕計画を確認。戸建ならハザードマップや越境を確認します。""",
            "アクション": """・昼夜、雨天時の周辺環境確認\n・ゴミ置き場の管理状態チェック\n・管理組合の財務状況確認""",
            "ポイント": """【管理を買う】マンションは「管理を買え」と言われます。プロはエントランスではなく「駐輪場とゴミ置き場」を見ます。ここが乱れている物件は管理組合が機能しておらず、将来の修繕積立金不足や資産価値の下落を招きます。また、長期修繕計画書を読み込み、直近で「大規模修繕」があるか、その一時金徴収予定がないかを確認するのが必須のアクションです。"""
        },
        "4.購入申込": {
            "内容": """買主としての意思表示を「買付証明書」にて行います。希望価格、支払方法、契約希望日、ローン特約の有無を記載します。""",
            "アクション": """・買付証明書の記入・提出\n・手付金の準備（現金100〜数百万）""",
            "ポイント": """【一番手の死守】不動産は早い者勝ちです。プロは内見前に「事前審査」を済ませ、内見直後にその場で買付を書く準備をさせます。さらに、単に申し込むだけでなく「家族のプロフィール（手紙）」を添えることもあります。売主が「この人に住んでほしい」と思えば、数百万の価格差を逆転して契約できるケースがあるからです。"""
        },
        "5.契約交渉": {
            "内容": """売主側の条件とすり合わせ。価格交渉をする場合は『なぜその価格なのか（修繕が必要だから等）』の理由を添えるのがマナーです。""",
            "アクション": """・価格交渉の依頼\n・引渡し時期の再確認（現居の退去に合わせる）""",
            "ポイント": """【落とし所の設計】無茶な値下げ交渉は、売主を頑なにし、契約を破談にさせます。プロは「設備に不具合があるからその分を引いてほしい」という論理的な交渉を行います。また、価格が下がらないなら「クリーニングを売主負担で入れてもらう」などの条件交渉に切り替えます。双方が「勝った」と思えるWin-Winの合意点を見極めるのがプロの技です。"""
        },
        "6.媒介契約": {
            "内容": """購入手続きをサポートする不動産会社と結ぶ契約。仲介手数料の支払い義務やサポート内容が明文化されます。""",
            "アクション": """・媒介契約書の内容確認\n・サービス内容の最終確認""",
            "ポイント": """【パートナーシップ】媒介契約は、エージェント（不動産会社）との信頼関係の証です。手数料の多寡だけでなく、そのエージェントが「住宅ローン控除の知識があるか」「アフ
